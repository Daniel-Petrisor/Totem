{% load static %}
<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
  
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>

    <title>Django-Websocket-|-Real-Time-Graph-with-Chart.js</title>
  </head>
  <body>

    <div class="container">
        <div class="row">
            <div class="col-10 mx-auto mt-4">
              <h1 id="app">{{ text }}</h1>
              <canvas id="myChart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>



    
    <!-- jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.js" integrity="sha512-CX7sDOp7UTAq+i1FYIlf9Uo27x4os+kGeoT7rgwvY+4dmjqV0IuE/Bl5hVsjnQPQiTOhAX1O2r2j5bjsFBvv/A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


    <script src="{% static 'js/main.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
  
    <!-- jquery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.js" integrity="sha512-WNLxfP/8cVYL9sj8Jnp6et0BkubLP31jhTG9vhL/F5uEZmg5wEzKoXp1kJslzPQWwPT1eyMiSxlKCgzHLOTOTQ==" crossorigin="anonymous"></script>
    
    <script type="text/javascript">
      
      // Correctly decide between ws:// and wss://
	    var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
	    var ws_path = ws_scheme + '://' + window.location.host + ":8001/ws/graph/";       // PRODUCTION
	    // var ws_path = ws_scheme + '://' + window.location.host + "/";
	    console.log("Connecting to " + ws_path);
	  
      var socket = new WebSocket(ws_path);


      socket.onopen =function(e){
        alert('Connection established');
      };

      socket.onmessage = function(e){
          console.log(e.data);
          var recData=JSON.parse(e.data);
          dataObjNew=dataObj['data']['datasets'][0]['data'];
          dataObjNew.shift();
          dataObjNew.push(recData.value);
          dataObj['data']['datasets'][0]['data']=dataObjNew;
          window.myLine.update();

      };

      socket.onclose = function(e){
          alert('Connection CLosed');
      };

      var dataObj={
        type: 'line',
        data: {
            labels: [1,2,3,4,5,6],
            datasets: [{
                label: 'Real time data',
                data: [12, 19, 3, 5, 2, 3],
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    }
    var ctx = document.getElementById('myChart').getContext('2d');
    window.myLine = new Chart(ctx,dataObj );
    </script>
  
  
  
  </body>
</html>